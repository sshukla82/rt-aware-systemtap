2008-03-06  Ananth N Mavinakayanahalli <ananth@in.ibm.com

	* i686/syscalls.stp: Handle sys_sigaltstack parameter after
	register unification

2008-02-28  Will Cohen  <wcohen@redhat.com>
	
	PR433780
	* errno.stp (returnstr): Handle unified i386/x86_64 reg names.

2008-02-27  Masami Hiramatsu <mhiramat@redhat.com>

	* x86_64/syscalls.stp (syscall.iopl): Use new_iopl instead of level
	on xen kernel.

2008-01-25  Will Cohen  <wcohen@redhat.com>
	
	PR5554
	* syscalls.stp (__is_user_regs): Modify to work with older kernels.

2008-01-23  Masami Hiramatsu <mhiramat@redhat.com>

	PR5554
	* syscalls.stp (__is_user_regs): Add new function to check whether
	pt_regs is user mode registers.
	(syscall.fork): Use __is_user_regs() to decide syscall name.

2008-01-16  Eugene Teo  <eteo@redhat.com>

	* signal.stp (get_sa_flags, get_sa_handler): New functions to
	return addresses of sa_flags and sa_handler of struct k_sigaction.
	(sigset_mask_str): New function. Returns a string containing the
	set of signals to be blocked when executing the signal handler.
	(is_sig_blocked): New function. Checks task_struct->blocked signal
	mask for signals that are currently blocked.
	(signal_str): New function. Translates a signal number.
	(sa_flags_str): New function. Translates the sa_flags.
	(sa_handler_str): New function. Returns the signal action or handler
	associated to the signal.

2008-1-4  Masami Hiramatsu <mhiramat@redhat.com>

	* aux_syscalls.stp (_stp_fork_list): Check kernel version for new
	flags.

2008-1-4  Masami Hiramatsu <mhiramat@redhat.com>

	PR5152
	* scheduler.stp (scheduler.ctxswitch): Change probe point __switch_to
	to context_switch on ia64.

2007-12-27  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Yang Zhiguo <yzgcsu@cn.fujitsu.com>
	* signal.stp (_signal.send.part3.return): Correct name variable.

2007-12-25  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Yang Zhiguo <yzgcsu@cn.fujitsu.com>
	* aux_syscalls.stp (_struct_sigaction_u): Delete overlaped
	SA_SIGINFO from _stp_sa_flags_list[].

2007-12-21  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Yang Zhiguo <yzgcsu@cn.fujitsu.com>
	* aux_syscalls.stp (_futex_op_str): Add new futex options.
	(_stp_fork_list[]): Add new clone flags.

2007-12-17  Martin Hunt  <hunt@redhat.com>

	* syscalls.stp (get_mempolicy): Fix syntax. Add prototype.
	(kexec_load): Ditto.
	(mbind): Ditto.
	(move_pages): Ditto.
	
2007-12-17  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Yang Zhiguo <yzgcsu@cn.fujitsu.com>
	* Add new address family to _fam_num2str: IUCV and RXRPC.

2007-12-17  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Bai Weidong <baiwd@cn.fujitsu.com>
	* syscalls.stp: Add missed compat* probes in syscalls.stp.

2007-12-12  Martin Hunt  <hunt@redhat.com>

	* syscalls2.stp (compat_sys_ptrace): Remove for now.
	Utrace-patched kernels have a different compat_sys_ptrace().

2007-12-7  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Yang Zhiguo <yzgcsu@cn.fujitsu.com>
	* syscalls2.stp: Add missed compat* probes in syscalls2.stp.

2007-12-7  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Bai Weidong <baiwd@cn.fujitsu.com>
	* aux_syscalls.stp (__sem_flags): Add the missed mode display,
	Fix calculation error when string is empty.

2007-11-21  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Bai Weidong <baiwd@cn.fujitsu.com>
	* syscalls2.stp (rt_sigsuspend): Fix the semantic error caused by
	the difference of kernel versions on IA64.

2007-11-14  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Lai Jiangshan <laijs@cn.fujitsu.com>
	* signal.stp (signal.do_action): Call __get_action_mask to get mask
	to fix semantic error of accessing a struct.
	* signal.stp (__get_action_mask): Add.

2007-11-12  Martin Hunt  <hunt@redhat.com>

	* logging.stp (print_char): Remove.  Now implemented by 
	stap.
	(log): Add a comment that it is deprecated.
	
2007-11-12  Martin Hunt  <hunt@redhat.com>
	
	* syscalls2.stp (sys_remap_file_pages: : Change kernel 
	version check to >= 2.6.24.

2007-11-8  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Lai Jiangshan <laijs@cn.fujitsu.com>
	* rpc.stp (clones_from_clnt): Use deref to check, then use
	atomic_read to read an atomic_t to avoid compilation error of
	type matching.
	(tasks_from_clnt): Ditto.

2007-11-6  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Cai Fei <caifei@cn.fujitsu.com>
	* rpc.stp (sunrpc.clnt.call_sync): Define procname only for
	kernel>=2.6.17.
	(sunrpc.clnt.call_async): Ditto.

2007-11-5  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Cai Fei <caifei@cn.fujitsu.com>
	* nfs_proc.stp: Use kread in get_ip and get_prot to avoid kernel
	panic.

2007-11-2  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Cai Fei <caifei@cn.fujitsu.com>
	* nfsd.stp: Fix the semantic error caused by the difference of
	kernel versions.
	* nfs_proc.stp: Ditto.

2007-11-1  Will Cohen  <wcohen@redhat.com>

	* syscall2.stp (sys_remap_file_pages): Fix compile error with kernel
	version greater than 2.6.23.

2007-11-1  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Lai Jiangshan <laijs@cn.fujitsu.com>
	* rpc.stp (clones_from_clnt): Add CATCH_DEREF_FAULT().
	(tasks_from_clnt): Ditto.

2007-10-17  Martin Hunt  <hunt@redhat.com>
	PR5000
	* endian.stp (set_endian): Remove.

2007-10-15 Dave Wilder <dwilder@us.ibm.com>

	*aux_syscalls.stp:_dfd_str  Added test for 32-bit value of AT_FDCWD

2007-10-15  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Cai Fei <caifei@cn.fujitsu.com>
	* conversions.stp: Add a function kernel_string_n for copy
	non-0-terminated string with fixed length from kernel space at
	given address.
	* stapfuncs.5.in: Add kernel_string_n.
	* nfsd.stp: Using kernel_string_n to copy non-0-terminated string
	with fixed length from kernel space at given address.
	* nfs_proc.stp: Ditto.

2007-10-12  Zhaolei  <zhaolei@cn.fujitsu.com>

	* queue_stats.stp (qsq_start): Fix problem that compile fails when
	calling qsq_utilization or other query functions next to qsq_start.

2007-10-11  Zhaolei  <zhaolei@cn.fujitsu.com>

	* queue_stats.stp (qsq_utilization): Update queue account datas
	before calculate.
	(qsq_blocked): Ditto.
	(qsq_wait_queue_length): Ditto.
	(qsq_service_time): Ditto.
	(qsq_wait_time): Ditto.
	(qsq_throughput): Ditto.

2007-10-11  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Cai Fei <caifei@cn.fujitsu.com>
	* nfs_proc.stp (__nfs_write_data_info): Add data-access code for
	count, valid and timestamp.

2007-10-11  Zhaolei  <zhaolei@cn.fujitsu.com>

	* udp.stp: Add name argument for all probes.

2007-10-10  Martin Hunt  <hunt@redhat.com>

	* aux_syscalls.stp (_stp_lookup_str): When defaulting
	to a numeric value, append, don't overwrite.

2007-10-10  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Lai Jiangshan <laijs@cn.fujitsu.com>
	* aux_syscalls.stp (_stp_lookup_or_str) redirect to _stp_lookup_str
	if val is 0.

2007-10-09  Mike Mason  <mmlnx@us.ibm.com>

	* rpc.stp: Replaced atomic_read()'s with kread()'s

2007-10-09  Martin Hunt  <hunt@redhat.com>
        PR5153
	* aux_syscalls.stp (_sighandler_str): No
	sa_restorer field for IA64.

2007-10-09  Martin Hunt  <hunt@redhat.com>
	
	* syscalls2.stp (sys_signal): Call
	_sighandler_str().

	* aux_syscalls.stp (_stp_sigset_str): Don't
	include SIG_0.
	(_sighandler_str): New.
	
2007-10-09  Zhaolei  <zhaolei@cn.fujitsu.com>

	* queue_stats.stp (qsq_start): Add destruction for qs_utime.

2007-10-09  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Cai Fei <caifei@cn.fujitsu.com>
	* memory.stp (addr_to_node): Fix the compilation error of function
	addr_to_node on IA64.

2007-10-05  Martin Hunt  <hunt@redhat.com>

	* aux_syscalls.stp: Put #ifdef CONFIG_COMPAT
	around compat code.

	* syscalls2.stp (rt_sigaction, sigaction): Call
	_struct_sigaction_u().
	
	* aux_syscalls.stp (_struct_timeval): Removed. No longer 
	necessary now that we have structure access in scripts. 
	(_struct_timespec): Ditto.
	(_struct_itimerval): Ditto.
	(_struct_timezone_u): Remove random CATCH_DEREF_FAULT()
	line.
	(_stp_sigset_str): New.
	(_struct_sigaction_u): New.
	
2007-10-04  Frank Ch. Eigler  <fche@elastic.org>

	* inet.stp: New tapset for htonl and friends.

2007-10-04  Zhaolei  <zhaolei@cn.fujitsu.com>

	* queue_stats.stp (qsq_print): Make value of ops/s output as float

2007-10-03  Zhaolei  <zhaolei@cn.fujitsu.com>

	* aux_syscalls.stp(_sockopt_level_str): Add support for protocol
	number 134~137.
	* socket.stp (global define,begin): Ditto.

2007-10-02  Zhaolei  <zhaolei@cn.fujitsu.com>

	* tcp.stp: Add name argument for all probes.
	* tcp.stp (tcp.setsockopt.return): Add comment.

2007-10-01  Martin Hunt  <hunt@redhat.com>

	* aux_syscalls.stp (_str_lookup_str): Print unmatched 
	values in hex.

2007-10-01  Zhaolei  <zhaolei@cn.fujitsu.com>

	* socket.stp (_success_check): Fix compare method.

2007-09-27  Martin Hunt  <hunt@redhat.com>

	* aux_syscalls.stp (_stp_lookup_str, _stp_lookup_or_str):
	New functions to efficiently and safely read arrays of values
	and return a string.
	(_signal_name): Reimplement using _stp_lookup_str().
	(_semctl_cmd): Ditto.
	(__fork_flags): Ditto.
	(_mmap_flags): Ditto.
	(_mprotect_prot_str): Ditto.
	(_shmat_flags_str): Ditto.
	(_at_flag_str): Ditto.
	(get_mmap_args): Complete rewrite for safety and correctness.
	
2007-09-27  Wenji Huang  <wenji.huang@oracle.com>

        * rpc.stp (clones_from_clnt, tasks_from_clnt): Fix for kernel >= 2.6.22.
	* nfs.stp (__nfsi_ndirty) : Ditto.
	* nfs_proc.stp (__nfsv4_bitmask) : Make bitmask valid according to CONFIG.

2007-09-27  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Cai Fei <caifei@cn.fujitsu.com>
	* rpc.stp (sunrpc.clnt.shutdown_client): Add argument progname's
	definition for probe sunrpc.clnt.shutdown_client, because it
	is in the man page but not defined in tapset.

2007-09-27  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Cai Fei <caifei@cn.fujitsu.com>
	* rpc.stp (sunrpc.clnt.call_sync, sunrpc.clnt.call_async): Fix
	the output format of flags in argstr from hex to decimal just
	to make it same as other probes.

2007-09-27  Zhaolei  <zhaolei@cn.fujitsu.com>

	* tcp.stp (sendmsg.return): Fix description of size variable.
	* tcp.stp (recvmsg.return): Ditto.

2007-09-27  Zhaolei  <zhaolei@cn.fujitsu.com>

	* socket.stp (aio_read): Fix compile error with kernel version
	less than 2.6.19.
	* socket.stp (aio_write): Ditto.

2007-09-26  Mike Mason <mmlnx@us.ibm.com>

	* vfs.stp:
	Specified explicit types for __find_bdevname() parameters
	and return value.  The types could not be determined correctly
	when __find_bdevname() was used in nfs.stp

	Added __page_index() to work around problem dereferencing unions
	in stap language.
	
	Made generic.fop.sendfile conditional on kernel <= 2.6.22.
	generic_file_sendfile() was removed in 2.6.23.

2007-09-26  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Lai Jiangshan <laijs@cn.fujitsu.com>
	* syscall.stp (syscall.brk): Add probe point
	kernel.function("ia64_brk").
	* syscall.stp (syscall.mremap): Add probe point
	kernel.function("ia64_mremap").

2007-09-26  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Lai Jiangshan <laijs@cn.fujitsu.com>
	modify field-access operator from "." to "->" in all files.

2007-09-26  Zhaolei  <zhaolei@cn.fujitsu.com>

	* syscalls.stp (adjtimex.return): Improve retstr.
	* aux_syscalls.stp: Add a function(_adjtimex_return_str) for
	adjtimex.return.

2007-09-25  Frank Ch. Eigler  <fche@elastic.org>

	* socket.stp (sock_flags_num2str): Define SOCK_PASSCRED if needed.

2007-09-25  Frank Ch. Eigler  <fche@elastic.org>

	* nfs_proc.stp (__i2n_ip_proto): Add a cast for 32-bit compatibility.

2007-09-25  Frank Ch. Eigler  <fche@elastic.org>

	* signal.stp (_signal.send.part*): Remove sinfo alias variable,
	since it's a struct rather than integral value.

2007-09-25  Martin Hunt  <hunt@redhat.com>

	* syscalls2.stp (sys_readlinkat): Make optional.

	* aux_syscalls.stp (_struct_compat_timeval_u): ifdef
	CONFIG_COMPAT so buildok test will pass.

2007-09-25  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Cai Fei <caifei@cn.fujitsu.com>
	* rpc.stp Fix the wrong calling of returnstr($return) to
	returnstr(1) or returnstr(2).

2007-09-25  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Cai Fei <caifei@cn.fujitsu.com>
	* rpc.stp Add function for probe point sunrpc.clnt.create_client.

2007-09-24  Martin Hunt  <hunt@redhat.com>

	* aux_syscalls.stp (_at_flag_str): Add some more flags.
	* syscalls2.stp (openat): Call _dfd_str().

2007-09-24  David Smith  <dsmith@redhat.com>

	* nfsd.stp (__svc_fh): Added missing semicolon.

2007-09-24  Frank Ch. Eigler  <fche@elastic.org>

	* aux_syscalls.stp: Add missing CATCH_DEREF_FAULT()s. 

2007-09-24  Frank Ch. Eigler  <fche@elastic.org>

	* inet_sock.stp, ioblock.stp, rpc.stp, scsi.stp, socket.stp,
	tcp.stp: Add /* pure */ to embedded-C functions.

2007-09-24  Frank Ch. Eigler  <fche@elastic.org>

	* conversions.stp (user_string): Redefine in terms of user_string2.

2007-09-23  Ulrich Drepper <drepper@redhat.com>

	* syscalls2.stp (readlinkat): Add.

2007-09-21  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Lai Jiangshan <laijs@cn.fujitsu.com>
	* aux_syscalls.stp (_sys_open_flag_str): Fix bug that missing
	"O_ASYNC".

	From Lai Jiangshan <laijs@cn.fujitsu.com>
	* aux_syscalls.stp: Add a function _mremap_flags.
	* syscalls.stp (syscall.mremap): Use _mremap_flags instead of
	_mmap_flags.

2007-09-21  Zhaolei  <zhaolei@cn.fujitsu.com>

	* aux_syscalls.stp(_reboot_magic_str) Fix the problem that
	LINUX_REBOOT_MAGIC1 printed as UNKNOWN VALUE.

2007-09-19  Martin Hunt  <hunt@redhat.com>
        PR 2295
	* syscalls.stp (sys_bdflush): Make optional.
	(sys_madvise): Ditto.
	(sys_mincore): Ditto.
	(sys_mlock): Ditto.
	(sys_mlockall): Ditto.
	(sys_mprotect): Ditto.
	(sys_mremap): Ditto.
	(sys_msync): Ditto.
	(sys_munlock): Ditto.
	(sys_munlockall): Ditto.
	* syscalls2.stp (sys_remap_pages): Make optional.
	* ppc64/syscalls.stp (ppc_rtas): Make optional.

2007-09-19  Zhaolei  <zhaolei@cn.fujitsu.com>

	* syscall.stp(getrusage) Fix the output of getrusage's argstr
	when who is set to -2.

2007-09-19  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Lai Jiangshan <laijs@cn.fujitsu.com>
	* ia64/syscalls.stp Add a probe point syscall.sigaltstack for
	ia64.
	* signal.stp(signal.force_segv) Add a part(force_sigsegv_info)
	for signal.force_segv.

2007-09-13  David Smith  <dsmith@redhat.com>

	* task.stp (task_open_file_handles): Fixed for kernels less than
	version 2.6.15.
	(task_max_file_handles): Ditto.

2007-09-13  Martin Hunt  <hunt@redhat.com>

	* aux_syscalls.stp: Replace get_user calls with __stp_get_user.

2007-09-06  Zhaolei  <zhaolei@cn.fujitsu.com>

	* aux_syscalls.stp (_stp_sockaddr_str): Fix memory access error
	when calling with addrlen set to 0.

2007-09-06  Zhaolei  <zhaolei@cn.fujitsu.com>

	* aux_syscalls.stp (_module_flags_str): Modify combination of
	flags' values.

2007-09-04  Zhaolei  <zhaolei@cn.fujitsu.com>

	From Lai Jiangshan <laijs@cn.fujitsu.com>
	* syscalls2.stp (quotactl): Init special_str before use.
	(rt_sigqueueinfo): Change pid's type from %p to %d in argstr.

2007-08-31  Zhaolei  <zhaolei@cn.fujitsu.com>
	From Lai Jiangshan <laijs@cn.fujitsu.com>
	* aux_syscalls.stp (_mknod_mode_str): Fix file type
	judgement error.

2007-08-30  Wenji Huang  <wenji.huang@oracle.com>

        * nfs.stp (__iov_length): Update.
        (nfs.fop.aio_read, nfs.fop.aio_write): Update calling __iov_length.
        * vfs.stp (generic.fop.aio_read, generic.fop.aio_write): Modify evaluating count,buf.
        (generic.fop.readv*, generic.fop.writev*, generic.fop.splice_read*,
        generic.fop.splice_write*, generic.fop.read*, generic.fop.write*): Make optional.
        (vfs.__set_page_dirty_buffers.return): Add condition.
        (vfs.remove_from_page_cache.return): Fix typo.
        (vfs.block_sync_page.return): Remove size and units.

2007-08-30  Zhaolei  <zhaolei@cn.fujitsu.com>

	* syscalls2.stp (syslog): Make $buf output as address in argstr.

2007-08-29  Zhaolei  <zhaolei@cn.fujitsu.com>

	* syscalls2.stp (sysfs): Set argstr's format different
	by value of option arg.

2007-08-28  Wenji Huang  <wenji.huang@oracle.com>

        * tcp.stp (sockstate): Fix typo.

2007-08-28  Zhaolei  <zhaolei@cn.fujitsu.com>

	* syscalls.stp (bdflush): Add comma between args in argstr
	Set second parameter(data)'s type by first parameter(func)'s
	value in argstr.

2007-08-27  Martin Hunt  <hunt@redhat.com>

	* context.stp (module_name): New. Returns the current
	module name.

	* tcp.stp (tcp_sendmsg): For 2.6.23, parameters change.

2007-08-27  Wenji Huang  <wenji.huang@oracle.com>

        * signal.stp (signal.do_action): Modify evaluating sa_handler,sa_mask.

2007-08-27  Zhaolei  <zhaolei@cn.fujitsu.com>

	* syscalls2.stp(sendto): Set $addr as content string in argstr.

2007-08-24  Wenji Huang  <wenji.huang@oracle.com>

        * scheduler.stp (scheduler.cpu_on,scheduler.migrate): Make optional.
	(scheduler.migrate): Modify evaluating cpu_from with task_cpu.

2007-08-24  Zhaolei  <zhaolei@cn.fujitsu.com>

	* syscalls2.stp(send): Add len argument into argstr.

2007-08-09  William Cohen  <wcohen@redhat.com>

	* syscalls2.stp (compat_sys_utimensat): Correct function arg.

2007-08-23  Martin Hunt  <hunt@redhat.com>

	* syscalls2.stp (sys_tee.return): Make optional

2007-08-23  Martin Hunt  <hunt@redhat.com>
	
	* aux_syscalls.stp (_struct_compat_timeval_u): Fix
	array reference.
	(_struct_compat_timespec_u): Cast args to long.

2007-08-23  Martin Hunt  <hunt@redhat.com>
	
	From Cai Fei <caifei@cn.fujitsu.com>
	* aux_syscalls.stp (_waitid_opt_str): New.
	(_wait4_opt_str): Just handle wait4 options.
	* syscalls2.stp (sys_waitid): Use _waitid_opt_str.
	
2007-08-23  Wenji Huang  <wenji.huang@oracle.com>

        * rpc.stp (sunrpc.svc.process, sunrpc.svc.recv): Modify evaluating 
	sv_name,sv_prog,sv_nrthreads in kernel>=2.6.19.
	(sunrpc.sched.delay,sunrpc.sched.delay): Fix typo.
	(sunrpc.*.return): Change name by adding "return".

2007-08-23  Zhaolei  <zhaolei@cn.fujitsu.com>

	* aux_syscalls.stp (_send_flags_str): Add support for MSG_MORE
	(used in send, sendto, sendmsg and compat_sys_sendmsg).
	Change name of _send_flags_str to _sendflags_str for unify with
	_recvflags_str.

	* syscalls2.stp(send, sendto, sendmsg, compat_sys_sendmsg): Change
	name of _send_flags_str to _sendflags_str for unify with _recvflags_str.

2007-08-22  Martin Hunt  <hunt@redhat.com>

	* ppc64/syscalls.stp: Remove a bunch of
	non-ppc64 specific probes.

	* syscalls.stp (compat_sys_epoll_ctl): New.
	(compat_sys_epoll_wait): New.
	(sys_epoll_pwait): New.
	(compat_sys_epoll_pwait): New.	
	(compat_sys_keyctl): New.
	(compat_sys_mq_open): New.
	(compat_sys_futex): New.			      
	(compat_sys_mq_timedsend): New.
	(compat_sys_mq_timedreceive): New.
	(compat_sys_mq_notify): New.
	(compat_sys_mq_getsetattr): New.
	(init_module): Make optional and quote args.
	(sys_eventfd): New.
	
	* syscalls2.stp (sys_splice): New.
	(sys_vmsplice): New.
	(compat_sys_vmsplice): New.	
	(sys_tee): New.
	(sys_signalfd): New.	
	(compat_sys_signalfd): New.	
	(sys_timerfd): New.
	(compat_sys_timerfd): New.
	(old32_readdir): New.
	
2007-08-22  Martin Hunt  <hunt@redhat.com>
	
	* aux_syscalls.stp (_utimensat_flag_str): New.
	(_dfd_str): New.
	(_struct_timeval2_u): Deleted.
	(_struct_timeval_u): Take a number of structs to decode.
	(_struct_compat_timeval2_u): Deleted	
	(_struct_compat_timeval_u): Take a number of structs to decode.	
	(_struct_timespec_u): Take a number of structs to decode.
	Recognize UTIME_NOW and UTIME_OMIT.
	(_struct_compat_timespec_u): Ditto.
	
	* syscalls.stp (compat_sys_old_getrlimit): Removed.
	(sys_migrate_pages): New.
	(sys_move_pages): New.

	* syscalls2.stp (compat_sys_sigprocmask): Removed. Calls
	sys_sigprocmask.
	(compat_sys_sysinfo): New.	
	(compat_sys_rt_sigtimedwait): New.
	(sys_utimensat, compat_sys_utimensat): New.
	
	* ppc64/syscalls.stp (compat_sys_sigpending): Removed.
	Calls sys_ func.
	(compat_sys_setrlimit): Ditto.
	(compat_sys_getrlimit): Ditto.
	(compat_sys_old_getrlimit): Ditto.
	(compat_sys_getrusage): Ditto.
	(compat_sys_wait4): Ditto.
	(compat_sys_sched_setaffinity): Ditto.
	(compat_sys_sched_getaffinity): Ditto.	
	
2007-08-22  Wenji Huang  <wenji.huang@oracle.com>

        * nfsd.stp (nfsd.proc?.*): Modify evaluating client_ip 
	with function addr_from_rqst to make it compatible in kernel>=2.6.19
	(nfsd.proc4.compound,nfsd.read,nfsd.write): Fix typo.
	(nfsd.unlink): Fix reference to variable iap.

2007-08-22  Wenji Huang  <wenji.huang@oracle.com>

        * nfs.stp (__iov_length): Updated, Temporary here.
        * nfs_proc.stp (__i2n_ip_proto): Add type cast to sockaddr_in.
        (nfs.proc?.*): Modify evaluating count and offset.
        (nfs.proc?.read.return): Delete evaluating size and units.
        (nfs.proc?.write.return): Modify evaluating size.
        (nfs.proc?.create): Modify evaluating filename and filelen.
        (nfs.proc?.rename): Fix typo.

2007-08-22  Zhaolei  <zhaolei@cn.fujitsu.com>

	* syscalls2.stp (syscall.setdomainname): Add argstr content
	(argstr = "" -> argstr = sprintf("%p, %d", $name, $len)).

2007-08-21  Frank Ch. Eigler  <fche@elastic.org>

	From Cai Fei <caifei@cn.fujitsu.com>:
	* syscalls2.stp, syscalls.stp: Added several missing argstr/retstr
	variables.

2007-08-21  Zhaolei  <zhaolei@cn.fujitsu.com>

	* syscalls2.stp (syscall.select): Fixed variable name error
	(timeout_uaddr = $tv->$tvp).
	* aux_syscalls.stp (_recvflags_str): Add support for MSG_DONTWAIT
	used in recv, recvfrom, recvmsg, compat_sys_recvmsg

2007-08-20  Masami Hiramatsu <mhiramat@redhat.com>

	* ioblock.stp: Fix __bio_ino() not to access i_ino if the page is not
	assigned to any inode.

2007-08-20  Wenji Huang  <wenji.huang@oracle.com>

        * nfs.stp (nfs.fop.aio_read, nfs.fop.aio_write): Modify evaluating count.
	(__iov_length): New function.
	(nfs.fop.sendfile, nfs.aop.set_page_dirty, nfs.aop.prepare_write,
	 nfs.aop.release_page): Fix typo. 

2007-08-17  Martin Hunt  <hunt@redhat.com>
	From Lai Jiangshan <laijs@cn.fujitsu.com>
	* syscalls.stp (creat): Fix argstr.

2007-08-17  Wenji Huang  <wenji.huang@oracle.com>

        * ioscheduler.stp (ioscheduler.elv_add_request,
        ioscheduler.elv_completed_request): Add checking $rq.

	* memory.stp (_IS_ZERO_PAGE): Modify reference to arguments.

2007-08-16  Frank Ch. Eigler  <fche@elastic.org>

	PR 1315.
	* target_set.stp: New tapset file.

2007-08-16  Martin Hunt  <hunt@redhat.com>

	* aux_syscalls.stp (_sock_family_str):
	Add PF_IUCV, PF_RXRPC, PF_TIPC.

	From zhaolei@cn.fujitsu.com
	Remove PF_UNIX. PF_LOCAL is correct.
	
2007-08-16  Martin Hunt  <hunt@redhat.com>	

	* aux_syscalls.stp (__get_argv): Add parameter to 
	optionally skip the first argv (argv[0]).
	(__get_compat_argv): Ditto.

	* syscalls.stp (execve): Set args to the whole argv.
	For argstr use filename plus argv starting at [1].
	(compat_execve): Ditto.
	* ppc64/syscalls.stp (sys32_exevve): Ditto.
	
	From Cai Fei <caifei@cn.fujitsu.com>	
	* syscalls.stp (sts_getpgid): Add pid arg.

2007-08-16  Wenji Huang  <wenji.huang@oracle.com>

        * errno.stp: Fix Typo for EADV.

2007-08-15  Wenji Huang  <wenji.huang@oracle.com>

        * aux_syscalls.stp (_reboot_flag_str,_futex_op_str,_mprotect_prot_str,
	_fcntl_cmd_str, _quotaclt_cmd_str, _sock_type_str, _rlimit_resource_str,
	_rusage_who_str): Add new entries, modify default return string.

2007-08-15  Martin Hunt  <hunt@redhat.com>

	* x86_64/syscalls.stp: Add support for sys32_mmap[2],
	sys32_vm86_warning, and sys32_pipe.
	* s390x/syscalls.stp (get_mmap_args): Move to aux_syscalls.
	* aux_syscalls.stp (get_mmap_args): Moved here.
	* syscalls.stp: Add sys32_alarm.
	* syscalls2.stp: Add sys32_uname.
	
2007-08-15  Frank Ch. Eigler  <fche@elastic.org>

	* context.stp (cpuid, cpu): Use smp_processor_id().

2007-08-12  Wenji Huang  <wenji.huang@oracle.com>

	* aux_syscalls.stp(_sched_policy_str,_nfsctl_cmd_str): Add SCHED_BATCH to
	 policy entries, FSCTL_GETFD,NFSCTL_GETFS to nfsctl entries

2007-08-10  Josh Stone  <joshua.i.stone@intel.com>

	* conversions.stp (kernel_string, kernel_long, kernel_int,
	kernel_short, kernel_char, user_string_warn): Use the
	CONTEXT->error_buffer to create an error message instead of a static
	local array.

2007-08-10  Frank Ch. Eigler  <fche@elastic.org>

	From "Zhaolei" zhaolei@cn.fujitsu.com:
	* syscalls.stp (msync.return): Correct name variable.

2007-08-10  Frank Ch. Eigler  <fche@elastic.org>

	From "Zhaolei" zhaolei@cn.fujitsu.com:
	* aux_syscalls.stp (_sockopt_optname_str): Add SO_SND/RCVBUFFORCE.

2007-08-09  Frank Ch. Eigler  <fche@elastic.org>

	From Cai Fei <caifei@cn.fujitsu.com>:
	* aux_syscalls.stp (__fork_flags): Decode CLONE_VM, NEWNS, DETACHED.

2007-08-09  William Cohen  <wcohen@redhat.com>

	* tapset/syscalls.stp (syscall.compat_execve,
	syscall.compat_execve.return):
	* tapset/syscalls2.stp (syscall.compat_sys_semtimedop, 
	syscall.compat_sys_semtimedop.return):
	* tapset/i686/syscalls.stp (syscall.set_zone_reclaim,
	syscall.set_zone_reclaim.return): Make optional.

2007-08-08  Frank Ch. Eigler  <fche@elastic.org>

	From "Zhaolei" zhaolei@cn.fujitsu.com:
	* aux_syscalls.stp (_sockopt_level_str): Correct level=1 string.

2007-08-03  Martin Hunt  <hunt@redhat.com>

	* aux_syscalls.stp (__get_compat_argv): Add cast.

2007-07-31  Martin Hunt  <hunt@redhat.com>

	* syscalls*: Move sys32_sysctl to arch dirs.
	
2007-07-31  Martin Hunt  <hunt@redhat.com>

	* syscalls.stp (clock_nanosleep): Fix flags string.
	* syscalls2.stp: Fix typo.

2007-07-31  Martin Hunt  <hunt@redhat.com>	

	* */syscalls.stp: Added mmap functions.
	Continued moving common compatibility functions to
	the main tapset.

	* aux_syscalls.stp (_shmat_flags_str): New.
	(__get_compat_argv): New.

	* syscalls.stp (adjtimex): Just print hex argument.
	(compat_adjtimex): New.
	(clock_getres): Also probe compat_clock_getres.
	(clock_gettime): Also probe compat funcs.
	(compat_clock_nanosleep): New.
	(compat_execve): New.
	(fstatat): New.
	(get[e][gu]id): Also probe sys32.
	(getsockopt): Make optional. Also probe compat.
	(mmap, mmap2): These are arch-specific, so move to individual
	architecture subdirs.
	(compat_sys_msgctl): New.
	(compat_sys_msgrcv): New.
	(compat_sys_msgsnd): New.

	* syscalls.stp (pread32): Remove. It calls pread64 .
	(quotactl): Make optional.
	(recv): Probe correct function.
	(recvfrom): Fix args.
	(compat_sys_recvmsg): New.
	(semctl): Make optional.
	(compat_sys_semctl): New.
	(semget): Make optional.
	(semop): Make optional.	
	(semtimedop): Make optional.		
	(compat_sys_semtimedop): New.	
	(send): Make optional.
	(sendmsg): Make optional.
	(compat_sys_sendmsg): New.
	(sendto): Make optional.
	(setsockopt): Make optional. Add compat.
	(shmat): New.
	(compat_sys_shmat): New.
	(shmctl): New.
	(compat_sys_shmctl): New.
	(shmdt): New.
	(shmget): New.
	(shutdown): Make optional.
	(socket): Make optional.
	(socketpair): Make optional.
	(swapoff): Make optional.
	(swapon): Make optional.
	(sysctl): Add probe on sys32.

2007-07-31  Frank Ch. Eigler  <fche@elastic.org>
	
	PR 4793
	* ppc64/syscalls.stp: Remove duplicate sys_request_key{,.return}
	aliases.

2007-07-30 Dave Wilder <dwilder@us.ibm.com>

	PR 4794
	* syscalls2.stp (syscall.pread and syscall.pread32)
	For s390x only changed the $buf argument to $ubuf.
	Change the format for count and position from %p to %d
	to make it consistant with sys_read and sys_write.

2007-07-25  Mike Mason <mmlnx@us.ibm.com>

	PR 4386
	* memory.stp (vm.pagefault, vm.pagefault.return):
	__handle_mm_fault renamed back to handle_mm_fault in 2.6.23.
	Changed probes to look for either name in mm/memory.c and removed
	kernel version check.
	* task.stp (task_cpu): thread_info in task_struct changed
	to stack in 2.6.23. Usage appears to be the same as before.

2007-07-17  Mike Mason <mmlnx@us.ibm.com>

        * socket.stp: changed initialization of *num2str arrays to
	foreach loops.

2007-07-16  Martin Hunt  <hunt@redhat.com>
	(compat_sys_io_submit): Fix typo.

2007-07-16  Martin Hunt  <hunt@redhat.com>	
	* syscalls.stp (compat_sys_fcntl64, compat_sys_fcntl): Add.
	(compat_sys_fstatfs64): Add.
	(compat_sys_getdents, compat_sys_getdents64): Add.
	(compat_sys_ioctl): Add.
	(compat_sys_io_getevents): Add.
	(compat_sys_io_setup): Add.
	(compat_sys_io_submit): Add.

	* syscalls2.stp (compat_sys_nfsservctl): Add.
	(sys_openat): Add.
	(sys_ppoll): Add;
	(compat_sys_ppoll): Add.
	(sys32_pread64): Add.
	(sys32_pwrite32): Add.
	(sys_pwrite64): Print quoted string.
	(sys_pselect6, compat_sys_pselect6): Add.
	(sys_pselect7, compat_sys_pselect7): Add.
	(compat_sys_old_readdir): Add.
	(sys_select): Don't try to print fd_sets.
	(compat_sys_select): Add.
	(compat_sys_statfs64): Add.
	 
	* ppc/syscalls.stp: Remove duplicated probes.
	
	* aux_syscalls.stp (_nfsctl_cmd_str): New.
	(_fd_set_u): Removed. Not used.

2007-07-11  Eugene Teo  <eteo@redhat.com>

	* tcp.stp (tcp_sockstate_str, tcp_sockopt_str,
	tcp_setsockopt): New. Also added sockopt and sockstate
	lookup tables.

2007-07-10  Martin Hunt  <hunt@redhat.com>

	* aux_syscalls.stp (_struct_compat_timeval2_u): 
	Fixes.

2007-07-10  Martin Hunt  <hunt@redhat.com>	
	* syscall*.stp: Major reorganization work.
	* aux_syscalls.stp (_sigprocmask_how_str): Rewrite
	in C so real arch-dependent header files
	will be used.
	(_mlockall_flags_str): Ditto.

2007-07-09  Martin Hunt  <hunt@redhat.com>
	* syscalls2.stp (compat_sys_settimeofday): New.

2007-07-09  Martin Hunt  <hunt@redhat.com>	

	* syscalls2.stp (compat_sys_utimes): New.
	* ppc64/syscalls.stp (compat_sys_utimes): Removed.

	* syscalls.stp (compat_sys_futimesat): Fix arg.

2007-07-03  Martin Hunt  <hunt@redhat.com>

	* syscalls.stp: Add sys_futimesat, compat_sys_futimesat.
	* syscalls2.stp (utimes): Use _struct_timeval2_u.
	* aux_syscalls.stp (_struct_timeval2_u): New function.
	(_struct_compat_timeval2_u): New function.

2007-07-02  Martin Hunt  <hunt@redhat.com>

	* context.stp (print_backtrace): If no regs, just
	print the probe point.

2007-06-22  Frank Ch. Eigler  <fche@elastic.org>

	* syscalls_cfg_trunc.stp: New file for configuration global.
	* syscalls.stp (add_key, mount), syscalls2.stp (write):
	Use parameter.

2007-06-15  Martin Hunt  <hunt@redhat.com>

	* syscalls.stp: Add sys_fcntl64, sys_oabi_fstat64, 
	  sys_oabi_lstat64.
	* syscalls2.stp: Fix sys_send. Add sys_sendfile64.
	* errno.stp: Add arm support.

2007-06-14  Mike Mason <mmlnx@us.ibm.com>

	* socket.stp: removed extra assignment to "size" in 
	socket.aio_write.return

2007-06-07  Martin Hunt  <hunt@redhat.com>
	Fallout from PR 3331 fix. Sometimes glibc and the
	kernel disagree about signed vs unsigned.
	* aux_syscalls.stp: Rename __uid() to __int32().
	* syscalls.stp: Change syscall.chown, syscall.fchown, 
	syscall.lchown, and syscall.lseek to use __int32().
	* syscalls2.stp: Change syscall.setregid, syscall.resgid,
	syscall.resuid, and syscall.setreuid to use __int32().

2007-05-17  Martin Hunt  <hunt@redhat.com>

	* syscalls.stp: Make optional sys_alarm, sys_fadvise64,
	sys_gethostname, sys_getpgrp, and sys_llseek.
	(syscall.getrlimit): Add optional calls sys_old_getrlimit,
	compat_sys_getrlimit, and compat_sys_old_getrlimit.

	* syscalls2.stp: Make optional sys_nice, sys_rt_sigreturn,
	sys_signal, sys_sigprocmask, sys_utime
	(syscall.old_getrlimit): Moved into syscall.getrlimit.
	
2007-05-16  Will Cohen  <wcohen@redhat.com>
	PR 4471
	* syscall2.stp: Correct sys_pipe function args for ia64.
	
2007-05-16  Will Cohen  <wcohen@redhat.com>

	PR 4510
	* scheduler.stp: Correct function argument.
	
2007-05-09  Martin Hunt  <hunt@redhat.com>

	* syscalls2.stp: Added compat_sys_pause to syscall.pause.

	* syscalls.stp:	Added sys_lstat64 to syscall.lstat.
	Added compat_sys_gettimeofday to syscall.gettimeofday.

	* ppc64/syscalls.stp: Remove sys_lstat64.
	* i686/syscalls.stp: Remove sys_lstat64.

2007-04-25  David Wilder <dwilder@us.ibm.com>

        * syscall2.stp:syscall.pause added sys32_pause to probe list.

2007-04-25  David Wilder <dwilder@us.ibm.com>

        * s390x/syscall.stp: Fix bug in syscall.mmap returning the wrong args
			     for 32-bit versions of mmap calls.

2007-04-24  Will Cohen  <wcohen@redhat.com>

	* memory.stp: Update vm.pagefault.return comment.

2007-04-24  Mike Mason <mmlnx@us.ibm.com>

	* socket.stp: adapted to changes in 2.6.19 socket routines

2007-04-24  Will Cohen  <wcohen@redhat.com>

	* memory.stp: Add matching vm.pagefault.return

2007-04-23  Frank Ch. Eigler  <fche@elastic.org>

	* scheduler.stp (scheduler.ctxswitch): Since it's marked __kprobes
	switch from __switch_to to context_switch on x86-64 in Ipswitch.

2007-04-04  Sébastien Dugué  <sebastien.dugue@bull.net>

	* scsi.stp: Fix for when the scsi driver is built into the kernel.

2007-04-11  Martin Hunt  <hunt@redhat.com>

	* aux_syscalls.stp: Add in6.h include.

2007-04-10  Martin Hunt  <hunt@redhat.com>

	* logging.stp (print_char): New function.

	* aux_syscalls.stp: Clean up network includes.

2007-04-09  Mike Mason <mmlnx@us.ibm.com>

	* DEVGUIDE: Added new tapset developer's guide.

2007-03-30  Frank Ch. Eigler  <fche@elastic.org>

	PR 1570.
	* memory.stp, scheduler.stp, signal.stp, LKET/signal.stp: Adapt
	to .inline -> .function change.

2007-03-09  Pierre Peiffer  <pierre.peiffer@bull.net>

	* nfsd.stp (nfsd.dispatch): Change initialization of variable
	client_ip with a call to addr_from_rqst.
	* rpc.stp (addr_from_rqst): - update with changes in struct svc_rqst
	- __rpc_execute returns void now.  struct rpc_xprt modified since
	kernel 2.6.19.
	* nfs.stp, vfs.stp: Local variables f_dentry renamed, because
	conflicting with a new #define in kernel header linux/fs.h in 2.6.20.

2007-02-29 David Wilder <dwilder@us.ibm.com>

	*conversions.stp (kernel_int) added goto success; (PR 4419)

2007-02-22  David Wilder <dwilder@us.ibm.com>

	* syscalls.stp, s390x/syscall.stp: Created an s390x version of
	syscall.mmap, syscall.mmap2, syscall.mmap.return, syscall.mmap2.return.

2007-02-09  Fr ank Ch. Eigler  <fche@elastic.org>

	* conversions.stp (*): Make errmsg usage uniform.

2007-02-06  Josh Stone  <joshua.i.stone@intel.com>

	* aux_syscalls.stp, inet_sock.stp, ioblock.stp, ioscheduler.stp,
	nfs.stp, nfs_proc.stp, nfsd.stp, rpc.stp, scsi.stp, signal.stp,
	socket.stp, task.stp, tcp.stp, vfs.stp: Protect pointer dereferences
	with kread wherever possible.  Some places still have hazards, as
	marked with FIXMEs.

	* errno.stp (returnstr): Don't use return in tapset C functions.
	* aux_syscalls.stp (__uget_timex_m): Ditto.
	* nfsd.stp (__get_fh): Ditto.
	* nfs.stp, vfs.stp (<many functions>): Ditto.
	* string.stp (substr): Ditto. Also make sure start index is valid.

	* syscalls.stp (syscall.execve): Change __string to kernel_string.

2007-02-06  Frank Ch. Eigler  <fche@elastic.org>

	* conversions.stp (kernel_long/int/short/char): New functions.

2007-01-31  Martin Hunt  <hunt@redhat.com>

	* context.stp (print_backtrace): Modify for new
	_stp_stack_print.
	(backtrace): Just use _stp_stack_snprint().
	(print_stack): Use new _stp_print* functions.
	(probefunc): Use _stp_symbol_snprint.
	
2007-01-26  Josh Stone  <joshua.i.stone@intel.com>

	* vfs.stp (ppos_pos): Change deref() to kread() so i686 passes.

2007-01-25  Mike Mason <mmlnx@us.ibm.com>

	* socket.stp: Fix for missing SOCK_PASSSEC in kernels earlier
	than 2.6.18.

2007-01-25  Martin Hunt  <hunt@localhost.localdomain>

	* syscalls2.stp: Add sys32_ustat probe.

2007-01-23  Mike Mason <mmlnx@us.ibm.com>

	* socket.stp: Fixed bit checking method in sock_flags_num2str()
	to match how it's done in the kernel.

2007-01-23  Mike Mason <mmlnx@us.ibm.com>

	* socket.stp: New sockets tapset.

2007-01-23  Mike Mason <mmlnx@us.ibm.com>

	* string.stp: Added tokenize() and strtol() functions.

2007-01-17  Martin Hunt  <hunt@redhat.com>

	* syscalls.stp: Add syscall.creat.
	* syscalls2.stp: Add compat_sys_open.

2007-01-13  Mike Mason <mmlnx@us.ibm.com>

	* ioblock.stp: renamed __bio_direction() to bio_rw_num()

2007-01-12  Mike Mason <mmlnx@us.ibm.com>

	* x86_64/syscalls.stp: added ? to request_key aliases
	to prevent syscall.* failures on some kernels 

2006-12-29  Li Guanglei <guanglei@cn.ibm.com>

	From Gui Jian <guij@cn.ibm.com>
	* ioscheduler.stp, nfsd.stp, nfs.stp, nfs_proc.stp, 
	rpc.stp, vfs.stp: patch for 2.6.19 kernel
	
2006-12-18  Frank Ch. Eigler  <fche@elastic.org>

	* vfs.stp (ppos_pos): Protect contents with deref(), though
	this blocks operation on i686 due to bug #3079.

2006-12-13  Mike Mason <mmlnx@us.ibm.com>

	* scheduler.stp: fixed last line in scheduler.ctxswitch to
	reference $prev_p->state instead of $prev_p->pid.

2006-12-11  Li Guanglei <guanglei@cn.ibm.com>

	From Gui Jian <guij@cn.ibm.com>
	* nfs.stp, nfs_proc.stp, rpc.stp: patch for 2.6.9 kernel
	
2006-11-29  Li Guanglei <guanglei@cn.ibm.com>

	From Gui Jian <guij@cn.ibm.com>
	* scheduler.stp, vfs.stp: made idle_balance and 
	buffer_migrate_page optinal.
	
2006-11-20  Frank Ch. Eigler  <fche@elastic.org>

	* context.stp (caller_addr): Declare return type.

2006-11-07  Li Guanglei <guanglei@cn.ibm.com>

	From Gui Jian <guij@cn.ibm.com>
	* signal.stp, memory.stp: make do_mmap2, copy_cow_page
	and signal.handle.return optional since they are obsolete
	or failed to probe on 2.6.18.1/ppc64

2006-11-02  Frank Ch. Eigler  <fche@elastic.org>

	* README: Add a blurb against running these scripts directly.

2006-10-29  Thang Nguyen <thang.p.nguyen@intel.com>

	* context.stp: Added proper handling of statement
	* probe in probefunc() for IA64 (bz# 3423)

2006-10-16  Li Guanglei <guanglei@cn.ibm.com>
	* scsi.stp: check whether rq_disk is empty
	* scheduler.stp: revert changes for x86_64

2006-10-13  Li Guanglei <guanglei@cn.ibm.com>
	* scsi.stp: add some variables
	* scheduler.stp: skip __switch_to on x86_64

2006-10-12  Martin Hunt  <hunt@redhat.com>
	* context.stp (print_backtrace): Pass in new
	kretprobe instance arg.
	(backtrace): Ditto.
	(is_return): Rewrite.
	(stack_size): New.
	(stack_used): New.
	(stack_unused): New.
	(called_addr): New.
	(caller): New.	

2006-10-12  Li Guanglei <guanglei@cn.ibm.com>
	* ioscheduler.stp: bugfix to avoid refer to NULL pointer

2006-10-11  Li Guanglei <guanglei@cn.ibm.com>
	* nfs.stp, nfsd.stp: bugfix of pointer conversion on
	32-bit platform.
	* i686/syscall.stp: make sys_request_key optional since
	it failed to probe on 2.6.18/i386

2006-10-04  Frank Ch. Eigler  <fche@elastic.org>

	* context.stp (probefunc): Return empty string for
	userspace (< PAGE_OFFSET) pointers.

2006-09-26  David Smith  <dsmith@redhat.com>

	* test/run.sh: Changed 'stpd' references to 'staprun'.

2006-09-20  Josh Stone  <joshua.i.stone@intel.com>

	PR 3233
	* timestamp.stp (gettimeofday_ns): New function
	(gettimeofday_us, gettimeofday_ms, gettimeofday_s):
	Use gettimeofday_ns as the base unit.

2006-09-19  Li Guanglei <guanglei@cn.ibm.com>
	
	From Gui Jian <guijian@cn.ibm.com>

	* rpc.stp: Some changes and more comments of RPC tapset

2006-09-18  Martin Hunt  <hunt@redhat.com>

	* logging.stp (stp_print_binary): New function.
	* string.stp: Fix docs.

2006-09-12  Li Guanglei <guanglei@cn.ibm.com>
	
	From Li Xuepeng <xuepengl@cn.ibm.com>

	* nfsd.stp, nfs_proc.stp, nfs.stp: 
	Change NFS file identifier. Change NFS version data type
	from String to INT. Add version variable to nfs_open 
	and nfs_release.
	
2006-09-11  Li Guanglei <guanglei@cn.ibm.com>
	
	From Gui Jian(guijian@cn.ibm.com>
	* rpc.stp: tapsets for RPC activities.
	
2006-08-30  Li Guanglei <guanglei@cn.ibm.com>

	* signal.stp: some changes to arguments and comments 
	of signal tapset
	
2006-08-25  Li Guanglei <guanglei@cn.ibm.com>

	From Li Xuepeng:
	* vfs.stp,nfsd.stp,nfs.stp: bug fixes and more error checking
	
2006-08-23  Li Guanglei <guanglei@cn.ibm.com>

	* vfs.stp: New tapset from Thomas Zanussi(trz@us.ibm.com) to probe
	vfs layer activities.
	* nfs.stp: New tapset from Li Xuepeng(xuepengl@cn.ibm.com) to probe
	nfs file operations and nfs address space operations on client side.
	* nfs_proc.stp: New tapset from Li Xuepeng to probe some nfs RPC 
	procedure stub functions on client side.
	* nfsd.stp: New tapset from Li Xuepeng to probe nfs server side 
	activities, including some RPC procedure stub functions, nfsd 
	dispatch routine, and nfsd_* functions
	
2006-08-22  Li Guanglei <guanglei@cn.ibm.com>

	* signal.stp: More variables for signal.do_action and
	signal.procmask. New function of get_sigset(). Minor
	changes to naming of signal.pend and its comments

	
2006-08-21  Martin Hunt  <hunt@redhat.com>

	* string.stp (substr): Rewrite. Make the 3rd parameter
	be the length.

2006-08-17  Josh Stone  <joshua.i.stone@intel.com>

	* signal.stp: Changes on behalf of Manoj S Pattabhiraman:
	1. As per the suggestions, i have removed the argstr from the 
	probe points.
	2. Added some checks to find whether the signals generated are 
	USER or Kernel Mode in signal_handle probe.

2006-08-17  Li Guanglei <guanglei@cn.ibm.com>

	* signal.stp: update signal tapsets based on the discussion
	with Josh Stone on mailinglist:
	1. Added "send2queue" and "name" variable for signal.send.part* 
	2. Added signal.send.return probe alias 
	3. Added signal.checkperm and signal.checkperm.return probe alias
	4. Commented out signal.handle_stop
	5. Alias all signal syscalls to syscall tapsets.

2006-08-15  Thang Nguyen  <thang.p.nguyen@intel.com>

	* ioblock.stp:  Added safety checks for __bio_ino() and 
	__bio_start_sect(). 

2006-08-09  Thang Nguyen  <thang.p.nguyen@intel.com>

	* ioblock.stp: Merged io.stp from Tom Zanussi (IBM) into existing
	ioblock.stp.  Removed/Renamed duplicate variables and probes.	

2006-08-09  Josh Stone  <joshua.i.stone@intel.com>

	* signal.stp: Create a new tapset that addresses process signals.
	Much of this was contributed by Manoj Pattabhiraman (IBM).
	* process.stp: Remove aliases that now belong in signal tapset
	* memory.stp: move pagefault to vm.* namespace, and add many other
	virtual-memory themed probes.

2006-08-09  David Smith  <dsmith@redhat.com>

	* syscalls.stp: Fixed typo in syscall.kexec_load argument
	handling.

2006-08-08  Eugene Teo  <eteo@redhat.com>

	* context.stp (probemod): New function.

2006-07-18  Thang Nguyen  <thang.p.nguyen@intel.com>

	* context.stp: Modified probefunc() to print the function
	name (without the dot) for statement probe on ppc64.

2006-07-17  David Smith  <dsmith@redhat.com>

	* context.stp: Removed returnval() function.  Use $return
	instead.
	* return.stp: Removed.  Use $return instead.

2006-07-17  Tom Zanussi <zanussi@us.ibm.com>
	
	* ioblock.stp: add null bi_bdev check to bio_devname()

2006-07-17  Li Guanglei <guanglei@cn.ibm.com>
	
	* syscalls.stp: make sys_acct, sys_add_key, sys_keyctl 
	and sys_modify_ldt optional on ppc64 since they are 
	weak symbol.
	* ppc64/syscalls.stp: remove syscall.acct, syscall.add_key
	and syscall.umask since they are already defined in 
	syscalls.stp
	
2006-07-04  Martin Hunt  <hunt@redhat.com>

	* syscalls.stp, syscalls2.stp: Use user_string_quoted().

2006-07-04  Li Guanglei <guanglei@cn.ibm.com>
	
	* syscalls.stp, syscalls2.stp, ppc64/syscalls.stp: 
	fix syscall.lstat, syscall.lstat64, syscall.newlstat. 
	* ppc64/syscalls.stp: fix syscall.compat_sys_statfs and 
	syscall.sys32_open

2006-07-04  Li Guanglei <guanglei@cn.ibm.com>
	
	* memory.stp: add addr_to_node() from Jose R. Santos
	(jrs@us.ibm.com)
	* syscalls.stp: typo for syscall.lstat

2006-06-30  Martin Hunt  <hunt@redhat.com>

	* conversions.stp (user_string): Don't generate errors
	on faults, just return <unknown>.
	(user_string2): New function.
	(user_string_warn): New function.
	
2006-06-26  Martin Hunt  <hunt@redhat.com>

	* aux_syscalls.stp (_stp_ctime): New function.
	(_struct_utimbuf_u): New function.

2006-06-25  Li Guanglei <guanglei@cn.ibm.com>
	
	* syscalls.stp: Changes to AIO related syscalls(io_setup, 
	io_submit, io_getevents, io_cancel, io_destroy)
	
2006-06-23  Thang Nguyen  <thang.p.nguyen@intel.com>

	* tcp.stp: Refined variables and added more
	function descriptions.
	* udp.stp: UDP tapset.
	* inet_sock.stp: common inet_sock functions
	for TCP and UDP tapsets.

2006-06-22  Thang Nguyen  <thang.p.nguyen@intel.com>

	* tcp.stp: TCP tapset (originally from IBM)

2006-06-21  Josh Stone  <joshua.i.stone@intel.com>

	PR 2525
	* timestamp.stp (gettimeofday_us, gettimeofday_ms, gettimeofday_s):
	Convert to using the runtime-provided _stp_gettimeofday_us().

2006-06-19  Martin Hunt  <hunt@redhat.com>

	* syscalls.stp: Make the 16-bit calls optional.
	* syscalls2.stp: Ditto.

2006-06-09  Martin Hunt  <hunt@redhat.com>

	* syscalls2.stp: Fix sys_sync.

2006-06-09  Martin Hunt  <hunt@redhat.com>

	* syscalls2.stp: Fixed the uid and gid calls.	

2006-06-09  Li Guanglei <guanglei@cn.ibm.com>
	
	* syscalls.stp: made sys_ftruncate64 optional since it doesn't
	exist on 2.6.16*/ppc64

2006-06-08  Thang Nguyen  <thang.p.nguyen@intel.com>

	* ioblock.stp: new (block I/O activities)

2006-06-06  Josh Stone  <joshua.i.stone@intel.com>

	* process.stp (create, exec_complete): replace retval() with $return

2006-06-02  Josh Stone  <joshua.i.stone@intel.com>

	* process.stp (exec, exec_complete): conditionally include
	compat_do_execve for 64-bit kernels
	* process.stp (handle_signal): use optional probes to alternate
	between function or inline

2006-05-30  Martin Hunt  <hunt@redhat.com>

	* aux_syscalls.stp (_mountflags_str): Rewrite.
	(_umountflags_str): New.

	* syscalls.stp (fstatfs.return): Add retstr.

	* syscalls2.stp (sys_write): Use text_strn().
	* syscalls.stp (sys_lseek): Fix.
	(sys_llseek): Fix.
	
	* string.stp (text_str): New.
	(text_strn): New.

2006-05-26  Martin Hunt  <hunt@redhat.com>

	* errno.stp: Add octal option for returnstr.

	* [i686,x86_64]/syscalls.stp (umask): Print args and return
	in octal.
	(add_key): Comment out. This syscall is added by a xen patch
	and may not be present.
	(tux): Ditto.
	
	* syscalls.stp (accept): Fix arg name.

2006-05-25  Martin Hunt  <hunt@redhat.com>

	* syscalls.stp: Add sys_fcntl and sys_listen.

	* syscalls2.stp: Commented out sys_socketcall because it only calls 
	other system calls which are already probed.

2006-05-25  Martin Hunt  <hunt@redhat.com>
	
	* syscall*.stp: Change "0x%p" to "%p".

2006-05-25  Li Guanglei <guanglei@cn.ibm.com>
	
	* scheduler.stp: add prev_task and next_task variable.

2006-05-24  Josh Stone  <joshua.i.stone@intel.com>

	PR 2677
	* context.stp (probefunc): Use _stp_symbol_sprint_basic

2006-05-19  Li Guanglei <guanglei@cn.ibm.com>

	Patch from Mao Bibo (bibo.mao@intel.com)
	* tapset/aux_syscalls.stp: change %lx to %llx in snprintf to
	print the address in IA64

2006-05-19  Li Guanglei <guanglei@cn.ibm.com>

	* tapset/ioscheduler.stp: change . to -> operator to get the
	elevator name
	
2006-05-18  Li Guanglei <guanglei@cn.ibm.com>

	* tapset/LKET/*: tracing tapsets of LKET
	* tapset/context.stp: add stp_pid() func
	* tapset/ppc64/syscalls.stp: add conditional preprocessing
	since sys64_time is removed from kernel >= 2.6.16

2006-05-18  Li Guanglei <guanglei@cn.ibm.com>

	* tapset/tskschedule.stp: deleted, merge into scheduler.stp
	* tapset/scheduler.stp:   incorporate tskschedule.stp
	
2006-05-17  Josh Stone  <joshua.i.stone@intel.com>

	* process.stp: Rename signal.send to signal_send and process.complete
	to process_complete, to allow process.* to work properly.
	* process.stp (_IS_ERR): declare parameter type
	* process.stp (process.create): correct new_pid assignment
	* scheduler.stp: New scheduler tapset

2006-05-18  Li Guanglei <guanglei@cn.ibm.com>

	* tapset/ioscheduler.stp: generic IO scheduler tapsets from LKET
	* tapset/memory.stp:      generic pagefault tapsets from LKET
	* tapset/networking.stp:  generic networking tapsets from LKET
	* tapset/scsi.stp:        generic scsi tapsets from LKET
	* tapset/tskschedule.stp: generic task scheduler tapsets from LKET
	* tapset/process.stp:     changes to process.exec alias


2006-05-16  David Smith  <dsmith@redhat.com>

	* conversions.stp (hexstring, string): Removed functions.  Because
	of parser changes, "string" is now a reserved word and cannot be a
	function name.  Use 'sprintf("0x%x", num)' to replace hexstring()
	and either 'sprint(num)' or 'sprintf("%d", num)' to replace
	string().

	* syscalls.stp (syscall.accept, syscall.alarm, syscall.close,
	syscall.dup, syscall.epoll_create, syscall.exit, syscall.fchdir,
	syscall.fdatasync, syscall.fsync, syscall.getsid) Changed
	'string()' calls to 'sprint()' calls.
	* syscalls2.stp (syscall.sched_get_priority_max,
	syscall.sched_get_priority_min, syscall.sched_getscheduler,
	syscall.setfsgid, syscall.setfsgid16, syscall.setfsuid,
	syscall.setfsuid16, syscall.setgid, syscall.setgid16,
	syscall.setuid, syscall.setuid16, syscall.ssetmask,
	syscall.timer_delete, syscall.timer_getoverrun): Ditto.
	* i686/syscalls.stp (syscall.iopl, syscall.rt_sigreturn,
	syscall.sigreturn): Ditto.
	* ppc64/syscalls.stp (syscall.ppc64_personality): Ditto.
	* x86_64/syscalls.stp (kernel.syscall.iopl, kernel.syscall.umask):
	Ditto.

	* test/ctostp.sh: Uses 'sprint()' instead of 'string()' in
	generated systemtap code.

2006-05-14  Martin Hunt  <hunt@redhat.com>

	* aux_syscalls.stp (_sys_open_flag_str): Rewrite in C so it
	is complete and works on different archs.	

2006-05-09  Josh Stone  <joshua.i.stone@intel.com>

	* context.stp (probefunc): remove use of labels
	* task.stp: functions to retrieve task information
	* process.stp: tapset for process-related events

2006-05-08  Josh Stone  <joshua.i.stone@intel.com>

	PR 2594
	From Thang P Nguyen <thang.p.nguyen@intel.com>
	* context.stp (probefunc): expands ability to detect the function
	for different types of probes.

2006-05-05  Frank Ch. Eigler  <fche@elastic.org>

	PR 2643
	* syscalls.stp: Put back some dummy syscall.exit*.return probes.

2006-05-03  Frank Ch. Eigler  <fche@elastic.org>

	* context.stp, errno.stp: Note/eliminate some retval() duplication.

2006-04-27  Martin Hunt  <hunt@redhat.com>

	* endian.stp (set_endian): Remove "pure" to prevent
	this from optimizing away.

2006-04-21  Frank Ch. Eigler  <fche@elastic.org>

	* aux_syscalls.stp (_fildes_u): Declare return value type.

2006-04-18  Frank Ch. Eigler  <fche@elastic.org>

	* conversions.stp (string, hex_string): Use snprintf for safety.

2006-04-18  Martin Hunt  <hunt@redhat.com>

	* conversions.stp (user_string): Reenable error message.

2006-04-17  Martin Hunt  <hunt@redhat.com>

	* endian.stp (set_endian): New function.

2006-03-06  Martin Hunt  <hunt@redhat.com>

	* system.stp: New tapset. 

2006-03-01  Martin Hunt  <hunt@redhat.com>

	* aux_syscalls.stp (_struct_sockaddr_u): Parse sockaddr. 

	* syscalls.stp (bind): Call _struct_sockaddr_u().

	* errno.stp (errno_str): Complete rewrite in C for speed and
	accuracy.
	(returnstr): New function for syscall tapet.
	
2006-02-22  Frank Ch. Eigler  <fche@elastic.org>

	* timestamp.stp (get_cycles): New function.

2006-02-21  Martin Hunt  <hunt@redhat.com>

	* context.stp: Fix definition of returnval(). Now the same as retval().
	Cleanup needed. Only one can survive.

2006-02-17  Frank Ch. Eigler  <fche@elastic.org>

	* context.stp (cpu): Clone undocumented cpuid() function.

2006-02-14  Martin Hunt  <hunt@redhat.com>

	* syscalls.stp: More updates.

2006-02-14  Frank Ch. Eigler  <fche@elastic.org>

	* queue_stats.stp: New tapset.

2006-02-14  Mark McLoughlin  <markmc@redhat.com>

	* aux_syscalls.stp: (_sys_open_flag_str): s/O_NDCTTY/O_NOCTTY/

2006-02-14  Martin Hunt  <hunt@redhat.com>

	* aux_syscalls.stp (_struct_timeval_u): New function.
	(_struct_timeval): New function.
	(_struct_timespec_u): New function.
	(_struct_timespec): New function.	
	(_struct_itimerval_u): New function:
	(_struct_itimerval): New function:	
	(_signal_name): New function.
	(_module_flags_str): Fixed.

	* syscalls2.stp (syscall.setitimer): Use new function
	_struct_itimerval_u().

	* syscalls.stp: Latest version. Many changes.
	
2006-02-08  Martin Hunt  <hunt@redhat.com>

	* aux_syscalls.stp(_msync_flag_str): Fix.
	(_wait_opt_str): Fix.
	* syscalls.stp: Latest.
	
2006-02-07  Martin Hunt  <hunt@redhat.com>

	* syscalls.stp: Latest.
	* syscalls2.stp: Commented out pciconfig calls. Those
	need to go in arch-specific directories.

	* aux_syscalls.stp (_access_mode_str): Fix.
	(_mmap_flags): New Function.
	(_mprotect_prot_str): Fix.
	(__string): New.
	(__get_argv): New.
	(__fork_flags): New.

2006-02-01  Martin Hunt  <hunt@redhat.com>

	* syscalls.stp: New syscall file.
	* syscall2.stp: More syscalls.
	* i686/syscalls.stp: x86-specific calls.
	* x86_64/syscalls.stp: x86_64-specific calls.

2006-01-30  Martin Hunt  <hunt@redhat.com>

	* context.stp (probefunc): New function.
	(is_return): New function.
	(returnval): New function.

2006-01-15  Frank Ch. Eigler  <fche@elastic.org>

	* logging.stp: Revert.

2006-01-10  Martin Hunt  <hunt@redhat.com>

	* logging.stp: Don't set STAP_SESSION_STOPPING.
	That it done in _stp_exit().

